{% extends 'base.html' %}

{% block title %}Choose Timer{% endblock %}

{% block body %}
<div class="quiz-setup-container">
    <div class="quiz-setup-box">
        <h2>Start Quiz: {{ category.name }} Quiz</h2>

        <form action="{{ url_for('kuiz.start_quiz') }}" method="GET">
            <input type="hidden" name="category_id" value="{{ category.id }}">

            <div class="form-group">
                <label for="timer">Enter your custom time (in minutes):</label>
                <input type="number" id="timer" name="timer" min="1" max="60" value="1" required>
                <small>(1 minute to 60 minutes max)</small>
            </div>

            <div class="form-group">
                <label for="visibility">Filter by:</label>
                <select name="visibility" id="visibility" required>
                    <option value="all">All Decks (Default)</option>
                    <option value="personal">Personal Deck</option>
                    <option value="public">Public Deck</option>
                </select>
            </div>

            <div class="form-group">
                <label for="num_questions">Number of questions:</label>
                <input type="number" id="num_questions" name="num_questions" min="1" max="{{ visible_questions }}" required>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn-start">Start Quiz</button>
                <a href="{{ url_for('kuiz.answer') }}" class="btn-back">Back to Categories</a>
            </div>
        </form>
    </div>
</div>

<script>
    function updateMaxQuestions(visibleQuestions) {
        const numQuestionsInput = document.getElementById('num_questions');
        if (numQuestionsInput) {
            numQuestionsInput.max = visibleQuestions;
            if (parseInt(numQuestionsInput.value) > visibleQuestions) {
                numQuestionsInput.value = visibleQuestions;
            }
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        updateMaxQuestions({{ visible_questions }});
        document.getElementById('visibility').addEventListener('change', function (event) {
            const visibility = this.value;
            const categoryId = document.querySelector('input[name="category_id"]').value;
            fetch(`/filter-question?category_id=${categoryId}&visibility=${visibility}`)
                .then(response => response.json())
                .then(data => updateMaxQuestions(data.count))
                .catch(error => console.error('Error fetching question count:', error));
        });
    });
</script>
{% endblock %}
